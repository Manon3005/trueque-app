"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2159],{2159:(N,M,r)=>{r.r(M),r.d(M,{MessagesPageModule:()=>D});var d=r(2200),b=r(4341),o=r(9893),h=r(8132),v=r(8359),e=r(3664),p=r(2615),f=r(4412),I=r(6354);const c=()=>(new Date).toISOString(),P=[{id:"t1",title:"Mar\xeda",avatar:"assets/avatars/avatar1.png",lastMessage:"Hola, estoy interesado...",lastTimestamp:c(),unread:0},{id:"t2",title:"Carlos",avatar:"assets/avatars/avatar2.png",lastMessage:"\xbfTodav\xeda disponible?",lastTimestamp:c(),unread:1},{id:"t3",title:"Luc\xeda",avatar:"assets/avatars/avatar3.png",lastMessage:"Perfecto, gracias",lastTimestamp:c(),unread:0},{id:"t4",title:"Andr\xe9s",avatar:"assets/avatars/avatar4.png",lastMessage:"\xbfPuedes enviar m\xe1s fotos?",lastTimestamp:c(),unread:0}],k=[{id:"m1",threadId:"t1",fromUserId:"u1",fromName:"Mar\xeda",body:"Hola! Estoy interesado en tu mueble.",timestamp:c()},{id:"m2",threadId:"t1",fromUserId:"me",fromName:"T\xfa",body:"Hola Mar\xeda, claro, \xbfqu\xe9 quieres saber?",timestamp:c()},{id:"m3",threadId:"t2",fromUserId:"u2",fromName:"Carlos",body:"\xbfTodav\xeda disponible?",timestamp:c()},{id:"m4",threadId:"t3",fromUserId:"u3",fromName:"Luc\xeda",body:"Perfecto, gracias",timestamp:c()},{id:"m5",threadId:"t4",fromUserId:"u4",fromName:"Andr\xe9s",body:"\xbfPuedes enviar m\xe1s fotos?",timestamp:c()}];let C=(()=>{var a;class s{constructor(){this.threads$=new f.t(P),this.messagesMap=new Map;for(const n of k)this.messagesMap.has(n.threadId)?this.messagesMap.get(n.threadId).next([...this.messagesMap.get(n.threadId).value,n]):this.messagesMap.set(n.threadId,new f.t([n]))}getThreads(){return this.threads$.asObservable()}getThreadById(n){return this.threads$.asObservable().pipe((0,I.T)(t=>t.find(i=>i.id===n)))}getMessagesForThread(n){return this.messagesMap.has(n)||this.messagesMap.set(n,new f.t([])),this.messagesMap.get(n).asObservable()}sendMessage(n,t,i,l){const g={id:"m"+Math.random().toString(36).slice(2,9),threadId:n,fromUserId:t,fromName:i,body:l,timestamp:c()};if(this.messagesMap.has(n)){const u=this.messagesMap.get(n);u.next([...u.value,g])}else this.messagesMap.set(n,new f.t([g]));this.threads$.next(this.threads$.value.map(u=>u.id===n?{...u,lastMessage:l,lastTimestamp:g.timestamp,unread:0}:u))}static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)},this.\u0275prov=p.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}))}return a(),s})();var _=r(9987),y=r(385);function O(a,s){if(1&a&&(e.j41(0,"ion-note",4),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&a){const m=e.XpG();e.R7$(),e.SpI(" ",e.i5U(2,1,m.thread.lastTimestamp,"shortTime")," ")}}let T=(()=>{var a;class s{constructor(){this.select=new e.bkB}onClick(){this.select.emit(this.thread)}static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)},this.\u0275cmp=e.VBU({type:s,selectors:[["app-message-item"]],inputs:{thread:"thread"},outputs:{select:"select"},standalone:!1,decls:9,vars:4,consts:[["detail","false","button","",3,"click"],["slot","start"],[3,"src"],["slot","end",4,"ngIf"],["slot","end"]],template:function(t,i){1&t&&(e.j41(0,"ion-item",0),e.bIt("click",function(){return i.onClick()}),e.j41(1,"ion-avatar",1),e.nrm(2,"img",2),e.k0s(),e.j41(3,"ion-label")(4,"h2"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s()(),e.DNE(8,O,3,4,"ion-note",3),e.k0s()),2&t&&(e.R7$(2),e.Y8G("src","./assets/default-avatar.jpg",e.B4B),e.R7$(3),e.JRh(i.thread.title),e.R7$(2),e.JRh(i.thread.lastMessage),e.R7$(),e.Y8G("ngIf",i.thread.lastTimestamp))},dependencies:[d.bT,o.mC,o.uz,o.he,o.JI,d.vh],styles:[".message-item[_ngcontent-%COMP%]{--padding-start: 16px;align-items:center}.title[_ngcontent-%COMP%]{margin:0;font-weight:600;color:#222}.excerpt[_ngcontent-%COMP%]{margin:2px 0 0;color:#8b8f95;font-size:13px}.meta[_ngcontent-%COMP%]{text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:6px}.time[_ngcontent-%COMP%]{color:#777;font-size:12px}"],changeDetection:0}))}return a(),s})();function x(a,s){if(1&a){const m=e.RV6();e.j41(0,"app-message-item",15),e.bIt("select",function(t){p.eBV(m);const i=e.XpG();return p.Njj(i.openThread(t))}),e.k0s()}2&a&&e.Y8G("thread",s.$implicit)}let F=(()=>{var a;class s{constructor(n,t){this.messagesSvc=n,this.router=t,this.threads=[],this.visibleThreads=[],this.sub=new v.yU}ngOnInit(){const n=this.messagesSvc.getThreads().subscribe(t=>{this.threads=t,this.visibleThreads=t});this.sub.add(n)}ngOnDestroy(){this.sub.unsubscribe()}onSearch(n){const t=n.target.value.trim();t&&this.router.navigate(["/search",t])}openThread(n){this.router.navigate(["/messages",n.id])}trackById(n,t){return t.id}static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)(e.rXU(C),e.rXU(_.Ix))},this.\u0275cmp=e.VBU({type:s,selectors:[["app-messages"]],standalone:!1,decls:32,vars:3,consts:[["title","Mis mensajes"],["side","start"],["auto-hide","false"],["routerLink","/search","routerDirection","root","routerLinkActive","selected"],["slot","start","name","search-outline"],["routerLink","/favorites","routerDirection","root","routerLinkActive","selected"],["slot","start","name","heart-outline"],["routerLink","/new","routerDirection","root","routerLinkActive","selected"],["slot","start","name","add-circle-outline"],["routerLink","/messages","routerDirection","root","routerLinkActive","selected"],["slot","start","name","chatbubbles-outline"],["routerLink","/account","routerDirection","root","routerLinkActive","selected"],["slot","start","name","person-outline"],[3,"thread","select",4,"ngFor","ngForOf","ngForTrackBy"],[1,"footer-count"],[3,"select","thread"]],template:function(t,i){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-split-pane")(3,"ion-menu",1)(4,"ion-content")(5,"ion-list")(6,"ion-menu-toggle",2)(7,"ion-item",3),e.nrm(8,"ion-icon",4),e.j41(9,"ion-label"),e.EFF(10,"Buscar productos"),e.k0s()(),e.j41(11,"ion-item",5),e.nrm(12,"ion-icon",6),e.j41(13,"ion-label"),e.EFF(14,"Ver tus favoritos"),e.k0s()(),e.j41(15,"ion-item",7),e.nrm(16,"ion-icon",8),e.j41(17,"ion-label"),e.EFF(18,"Crear nuevo producto"),e.k0s()(),e.j41(19,"ion-item",9),e.nrm(20,"ion-icon",10),e.j41(21,"ion-label"),e.EFF(22,"Ver tus mensajes"),e.k0s()(),e.j41(23,"ion-item",11),e.nrm(24,"ion-icon",12),e.j41(25,"ion-label"),e.EFF(26,"Ver tu cuenta"),e.k0s()()()()()(),e.j41(27,"ion-content")(28,"ion-list"),e.DNE(29,x,1,1,"app-message-item",13),e.k0s(),e.j41(30,"div",14),e.EFF(31),e.k0s()()()()),2&t&&(e.R7$(29),e.Y8G("ngForOf",i.visibleThreads)("ngForTrackBy",i.trackById),e.R7$(2),e.SpI("",i.visibleThreads.length||0," discusiones"))},dependencies:[d.Sq,o.W9,o.iq,o.uz,o.he,o.nf,o.oS,o.cA,o.HP,o.N7,h.Wk,h.wQ,y.l,T],styles:[".search-bar-container[_ngcontent-%COMP%]{border-bottom:1.5px solid var(--ion-color-secondary);padding:5px;background-color:#fff}ion-searchbar[_ngcontent-%COMP%]{--border-radius: 10px}.page-title[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:28px;margin:22px 24px;font-weight:600;font-family:Libre Baskerville,serif}.footer-count[_ngcontent-%COMP%]{text-align:center;color:#999;font-size:12px;margin:40px 0}"]}))}return a(),s})(),j=(()=>{var a;class s{constructor(){this.placeholder="Escribe un mensaje...",this.disabled=!1,this.send=new e.bkB,this.text=""}ngOnInit(){}onSend(){const n=this.text&&this.text.trim();n&&(this.send.emit(n),this.text="")}static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)},this.\u0275cmp=e.VBU({type:s,selectors:[["app-chat-input"]],inputs:{placeholder:"placeholder",disabled:"disabled"},outputs:{send:"send"},standalone:!1,decls:5,vars:4,consts:[[1,"chat-input"],["lines","none"],[3,"ngModelChange","keyup.enter","ngModel","placeholder","disabled"],["fill","clear","title","Enviar",3,"click","disabled"],["slot","icon-only","name","send"]],template:function(t,i){1&t&&(e.j41(0,"div",0)(1,"ion-item",1)(2,"ion-input",2),e.mxI("ngModelChange",function(g){return e.DH7(i.text,g)||(i.text=g),g}),e.bIt("keyup.enter",function(){return i.onSend()}),e.k0s(),e.j41(3,"ion-button",3),e.bIt("click",function(){return i.onSend()}),e.nrm(4,"ion-icon",4),e.k0s()()()),2&t&&(e.R7$(2),e.R50("ngModel",i.text),e.Y8G("placeholder",i.placeholder)("disabled",i.disabled),e.R7$(),e.Y8G("disabled",!i.text||0===i.text.trim().length))},dependencies:[o.Jm,o.iq,o.$w,o.uz,o.Gw,b.BC,b.vS],styles:[".chat-input[_ngcontent-%COMP%]{padding:8px}.chat-input[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;border-radius:999px;box-shadow:0 1px #0000000a}.chat-input[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{width:100%}.chat-input[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:6px}"]}))}return a(),s})();function B(a,s){1&a&&(e.j41(0,"div",8),e.nrm(1,"img",9),e.k0s()),2&a&&(e.R7$(),e.Y8G("src","assets/icon/favicon.png",e.B4B))}function $(a,s){1&a&&e.nrm(0,"div",10)}let R=(()=>{var a;class s{constructor(){this.currentUserId="me"}ngOnInit(){}isMine(){return this.message&&this.message.fromUserId===this.currentUserId}static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)},this.\u0275cmp=e.VBU({type:s,selectors:[["app-message-buble"]],inputs:{message:"message",currentUserId:"currentUserId"},standalone:!1,decls:12,vars:10,consts:[[1,"buble-container"],["class","avatar",4,"ngIf"],[1,"buble"],[1,"meta"],[1,"name"],[1,"time"],[1,"body"],["class","spacer",4,"ngIf"],[1,"avatar"],[3,"src"],[1,"spacer"]],template:function(t,i){1&t&&(e.j41(0,"div",0),e.DNE(1,B,2,1,"div",1),e.j41(2,"div",2)(3,"div",3)(4,"small",4),e.EFF(5),e.k0s(),e.j41(6,"small",5),e.EFF(7),e.nI1(8,"date"),e.k0s()(),e.j41(9,"div",6),e.EFF(10),e.k0s()(),e.DNE(11,$,1,0,"div",7),e.k0s()),2&t&&(e.AVh("mine",i.isMine()),e.R7$(),e.Y8G("ngIf",!i.isMine()),e.R7$(4),e.JRh(i.message.fromName),e.R7$(2),e.JRh(e.i5U(8,7,i.message.timestamp,"shortTime")),e.R7$(3),e.JRh(i.message.body),e.R7$(),e.Y8G("ngIf",i.isMine()))},dependencies:[d.bT,d.vh],styles:[".buble-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin:8px 12px}.buble-container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:36px;height:36px}.buble-container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.buble-container[_ngcontent-%COMP%]   .buble[_ngcontent-%COMP%]{max-width:70%;padding:10px 12px;border-radius:12px;background:var(--ion-color-light);box-shadow:0 1px #0000000a}.buble-container[_ngcontent-%COMP%]   .buble[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.buble-container[_ngcontent-%COMP%]   .buble[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:11px;color:#666}.buble-container[_ngcontent-%COMP%]   .buble[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin-right:6px}.buble-container[_ngcontent-%COMP%]   .buble[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{margin-top:4px;white-space:pre-wrap;word-wrap:break-word}.buble-container.mine[_ngcontent-%COMP%]{justify-content:flex-end}.buble-container.mine[_ngcontent-%COMP%]   .buble[_ngcontent-%COMP%]{background:var(--ion-color-primary);color:#fff;border-bottom-right-radius:2px}.buble-container.mine[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{display:none}"]}))}return a(),s})();function U(a,s){if(1&a&&(e.qex(0),e.nrm(1,"app-message-buble",8),e.bVm()),2&a){const m=s.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("message",m)("currentUserId",n.currentUserId)}}function w(a,s){if(1&a&&(e.qex(0),e.DNE(1,U,2,2,"ng-container",7),e.bVm()),2&a){const m=s.ngIf,n=e.XpG();e.R7$(),e.Y8G("ngForOf",m)("ngForTrackBy",n.trackById)}}const S=[{path:"",component:F},{path:":id",component:(()=>{var a;class s{constructor(n,t){this.route=n,this.messagesService=t,this.currentUserId="me",this.sub=new v.yU}ngOnInit(){this.sub.add(this.route.paramMap.subscribe(n=>{const t=n.get("id");t&&(this.threadId=t,this.messages$=this.messagesService.getMessagesForThread(t),this.messagesService.getThreadById(t).subscribe(i=>this.thread=i),this.sub.add(this.messages$.subscribe(()=>{setTimeout(()=>this.content?.scrollToBottom(200),250)})))}))}onSend(n){this.threadId&&this.messagesService.sendMessage(this.threadId,this.currentUserId,"T\xfa",n)}trackById(n,t){return t.id}ngOnDestroy(){this.sub.unsubscribe()}static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)(e.rXU(_.nX),e.rXU(C))},this.\u0275cmp=e.VBU({type:s,selectors:[["app-message-thread"]],viewQuery:function(t,i){if(1&t&&e.GBs(o.W9,5),2&t){let l;e.mGM(l=e.lsd())&&(i.content=l.first)}},standalone:!1,decls:15,vars:5,consts:[["slot","start"],["defaultHref","/messages"],[1,"thread-title"],[3,"src"],[1,"messages-list"],[4,"ngIf"],[3,"send"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"message","currentUserId"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title")(5,"div",2),e.nrm(6,"img",3),e.j41(7,"span"),e.EFF(8),e.k0s()()()()(),e.j41(9,"ion-content")(10,"div",4),e.DNE(11,w,2,2,"ng-container",5),e.nI1(12,"async"),e.k0s()(),e.j41(13,"ion-footer")(14,"app-chat-input",6),e.bIt("send",function(g){return i.onSend(g)}),e.k0s()()),2&t&&(e.R7$(6),e.Y8G("src","./assets/default-avatar.jpg",e.B4B),e.R7$(2),e.JRh(null==i.thread?null:i.thread.title),e.R7$(3),e.Y8G("ngIf",e.bMT(12,3,i.messages$)))},dependencies:[d.Sq,d.bT,o.QW,o.W9,o.M0,o.eU,o.BC,o.ai,o.el,j,R,d.Jj],styles:[".messages-list[_ngcontent-%COMP%]{padding:8px 0 80px;min-height:100%;background:linear-gradient(#fff,#fafafa)}.thread-title[_ngcontent-%COMP%]{display:flex;align-items:center}.thread-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;margin-right:8px}"]}))}return a(),s})()}];let E=(()=>{var a;class s{static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)},this.\u0275mod=e.$C({type:s}),this.\u0275inj=p.G2t({imports:[h.iI.forChild(S),h.iI]}))}return a(),s})();var G=r(6972);let D=(()=>{var a;class s{static#e=a=()=>(this.\u0275fac=function(t){return new(t||s)},this.\u0275mod=e.$C({type:s}),this.\u0275inj=p.G2t({imports:[d.MD,b.YN,o.bv,E,G.G]}))}return a(),s})()}}]);